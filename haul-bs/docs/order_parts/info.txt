===================================================================================================
СОЗДАНИЕ/РЕДАКТИРОВАНИЕ ЗАКАЗА

- через метод - [ POST /api/v1/orders/parts ] создается пустой заказ в состоянии draft
    [ draft_at != null, status = new ], т.е. в момент перехода на страницу создание заказа,
    сам заказ уже существует и после дополняется данными, в историю не пишется

- через метод - [ POST /api/v1/orders/parts/{id} ] заказ обновляется
    - редактировать можно при двух статусах [new, in_progress]
    - обязательны при обновлении два поля: (customer_id, source), остальные поля
        можно добавлять постепенно ТОЛЬКО если заказ находиться в состоянии draft, иначе все поля обязательны
    - в историю заказ обновления пишутся только если заказ не в состоянии draft

    нельзя отредактировать заказ если он оплачен, в историю пишется только если заказ не
    в состоянии draft

Товары заказа (App\Http\Controllers\Api\V1\Orders\Parts\ItemController)
    - добавление/обновление/удаление товара - реализовано через отдельные методы:
        POST /api/v1/orders/parts/{id}/item - добавление
        POST /api/v1/orders/parts/{id}/item/{itemId} - обновление (кол-во)
        POST /api/v1/orders/parts/{id}/item/{itemId} - удаление

    - при добавлении item у товара проверятся есть ли delivery_cost, если есть то у данного товар бесплатная доставка
        и item проставляем free_shipping=true
    - также только при добавление item записывается price, old_price, delivery_cost товара, чтоб цена на товара на момент добавления
        на фронте нужно выводить цену как - price + delivery_cost, а старую цену (которая зачеркнута) - old_price + delivery_cost
    - также у item появляется поле - is_overload=true - это если товара тяжелее чем 150 фунтов, это влияет на доставку, у заказа
        с таким товаром, есть метод доставки только pickup
    - нельзя производить манипуляции с товаром если заказ оплачен и не соответствует статусам [new, in_progress],
        также нельзя удалить последний товар в заказе (заказ не может быть без товара)
    - при данных манипуляция обновляется общее кол-во товара и транзакция, т.е. при добавление товара -
        общее кол-во товара уменьшается и создается транзакция на резервирование товара (данные действия отображаются в
        истории товар), при обновлении - меняется общее кол-во в товар и транзакции, при удалении - возвращается кол-во
        к общему кол-ву товара, транзакция на резервирование удаляется
    - данные манипуляции с товаром записываются в историю заказа только если заказ не в состоянии draft

--------------------------------------------
Shipping method --DEPRECATED--
    [ POST /api/v1/orders/parts/{id}/shipping-methods ] - получение методов доставки для заказа,
    в данных такая структура =
    [
        'methods' = [],     // все методы, по определенному кейсу
        'items' = [],       // айтемы относящие к данным методам
    ],
    такая структура потому что есть товары у которых бесплатная доставка (уже включена в цену), и товары с платной доставкой
    соответственно у них разные методы доставок и эти два типа товаров могут быть в одном заказе, у заказ может быть два метода
    доставки со своим набором товаров

    используются сервисы: Ups, Usps, FedEx

    - если а данных в поле cost=0 это значит доставка бесплатная
    - если у заказ delivery_type=pickup - то возвращается один метод доставки pickup-free
    - если у заказ delivery_type=delivery а все товары с бесплатной доставкой,
        то возвращается один метод доставки - UPS_Standard
    - если у заказ delivery_type=delivery а все товары с платной доставкой,
        то делается запрос для получение всех метод доставки (еще не реализовано)
    - если у заказ delivery_type=delivery а все товары с платной/бесплатной доставкой,
        то возвращаем два метода для платного и бесплатного (описаны выше)

    - данные обновляются и добавляются через редактирование заказ, куда передается:
        - name - название метода, enum
        - cost
        - terms
        - items_ids - id всех айтемов которые относятся к данному методу доставки
    - поиск для обновления происходит по name
    - данные по методу доставки, которые не переданы, будут удалены
--------------------------------------------

Payment method
    добавляются и обновляются через редактирование заказа

После добавления все данных, для завершения создание заказа используется
метод [ POST /api/v1/orders/parts/{id}/checkout ], он проверяет наличие всех данных и
переводит заказ из состояния draft [ draft_at == null, status = new ]
    - создается история создание заказа
    - после того как заказ выходит из состояния draft по нему фиксируется история
    - если чекаут делает sales-manager, то он привязывается к данному заказу, а сам
        заказ переходит в статус in_progress
    - если заказ не в draft будет ошибка
    - если не будет данных по delivery_address, items, shippingMethods, payment_method
        вернется ошибка
    - если у заказа нет billing_address, то delivery_address продублируется в billing_address
    - если у delivery_address поле save=true, то этот адрес сохраняем кастомеру

ВСЕ драфтовые заказы будут удалены через день

СМЕНА СТАТУСА через метод [ POST /api/v1/orders/parts/{id}/change-status ]
    - нельзя переключить статус если у заказа нет sales_manager
    - фиксируется в истории
    - если у заказа нет статус, то можно переключить в new, in_progress
    - co c status=new, нельзя переключить в другие статусы, только со статуса status=in_progress,
        чтоб перейти в статус in_progress нужно назначить sales manager, если нужно отменить -
        то через метод [ POST /api/v1/orders/parts/{id}/cancel ], в данных по заказу есть поле - can_change_status
        которое указывает для фронта можно ли переключить статус
    - если у заказа status=in_progress, то можно переключить в pending_pickup, canceled, sent
    - если у заказа status=pending_pickup, то можно переключить в delivered
    - если у заказа status=sent, то можно переключить в delivered, lost, damaged.
        при переключении в статус sent, также приходят и сохраняются sent_data (
        метод доставки, стоимость, дата, трекинг номер)
    - если у заказа status=delivered, то можно переключить в returned.
        - при переводе если payment_terms у него - day_15 или day_30 ,
            то проставляем дату когда оплата будет просрочена (past_due_at),
            т.е. от текущей даты + 15(30) дней, о нее будет просчитывать просрочка
        - удаляется транзакции на резерв для товаров и создаются транзакции на продажу товаров (пишится в историю товара)
    - статусы - canceled, returned, lost, damaged, являются финальными, с них нельзя переключиться на
        другие статусы
    - для получения статусов на которые можно переключиться можно использовать метод
           [ GET /api/v1/orders/parts/catalog/statuses-to-switch/{id} ]

НАЗНАЧЕНИЕ SALES MANAGER через метод [ POST /api/v1/orders/parts/{id}/assign-sales-manager ]
    - если заказ был в статусе new, он автоматом переходит в статус in_progress
    - фиксируется в истории

REFUNDED (возвращение денег) через метод [ POST /api/v1/orders/parts/{id}/refunded ]
    - будет ошибка если заказ не оплачен
    - будет ошибка если заказ не в статусе - damaged, lost, canceled, returned
    - проставляется дата в поле refunded_at, что говорит о том что был возврат
    - фиксируется в истории
    - для фронта есть поле - can_refunded, которое указывает можно ли выполнить
        данное действие и is_refunded - был ли уже возврат

ОТМЕНА ЗАКАЗА через метод [ POST /api/v1/orders/parts/{id}/cancel ]
    - данное действие можно сделать при статусах - new, in_progress
    - по факту это перевод в статус - canceled
    - фиксируется в истории
    - товар в айтемах не возвращаются

ДОБАВЛЕНИЕ МЕТОДОВ ДОСТАВКИ происходит в момент переключения в статус sent:
    - передается массив sent_data, не более двух элементов, куда передается метод
        доставки, фактическая цена доставки, и время, а также трекинг номер, если он есть
    - редактируется данные записи через метод [ POST /api/v1/orders/parts/{id}/delivery/{deliveryId} ]

ДОБАВЛЕНИЕ ОПЛАТЫ через метод [ POST /api/v1/orders/parts/{id}/payment ]
    - админы вносят оплату вручную, может быть несколько оплат
    - в момент внесения, у заказ обновляются поля - paid_amount, debt_amount
    - если внесенная сумма равна общей сумме заказа, то проставляется что заказ оплачен
    - внесение платежей фиксируется в истории
УДАЛЕНИЕ ОПЛАТЫ через метод [ DELETE /api/v1/orders/parts/{id}/payment/{paymentId} ]
    - удаление платежей фиксируется в истории

PAST DUE (просрочка платежа)
    - при переводе в статус delivered проставляется дата когда оплата будет просрочена

ДОБАВЛЕНИЕ ЗАКАЗА ЧЕРЕЗ ECOMMERCE через метод [ POST /api/v1/e-comm/orders ]
    - фиксируется в истории
===================================================================================================
