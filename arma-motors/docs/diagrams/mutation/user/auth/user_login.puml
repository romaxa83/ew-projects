@startuml

title
<&lock-locked> Логин (Login)
end title

left header
Wezom
endheader

skinparam title {
    FontName Courier
    FontColor f5f5f5
}

skinparam header {
    FontName Courier
    FontColor f5f5f5
}

skinparam  {
    FontSize 13
    FontName Courier
    BorderColor black
    BackgroundColor 172b3a
    ArrowFontName Impact
    ArrowColor white
    ArrowFontColor f5f5f5
    ArrowFontSize 20
    ArrowThickness 16
}

skinparam activity {
    StartColor f5f5f5
    BarColor SaddleBrown
    EndColor f5f5f5
    BackgroundColor Peru
    BackgroundColor<< Event >> Olive
    BackgroundColor<< AA >> SaddleBrown
    BorderColor Peru
    DiamondBackgroundColor Peru
    DiamondBorderColor Peru
}

skinparam note {
    BorderColor 172b3a
}

start

if (получение пользователя и верификация пользовательских данных) then (true)

    :проверяем активные сессии у данного пользователя;

    if (проверяем наличие в пришедших данных \n ID-device и dropCurrentSession) then (true)

        if (у пользователя есть ID-device) then (true)
            if (переданное ID-device устройства равно с пользовательским ID-device) then (true)
                 -[dotted]->
            else (false)
                if (получаем авторизационую запись пользователя) then (true)
                    if (dropCurrentSession) then (true)
                        :удаляем данные по refreshToken и accessToken пользователя;
                        :устанавливаем новый ID-device пользователя;
                    else (false)
                        :кидаем исключение с кодом ошибки - 21 ;
                    endif
                else (false)
                    -[dotted]->
                endif
            endif
        else (false)
            :вызываем метод userService->setDeviceId()
            который записывает пришедшее ID-device пользователю;
        endif

    else (false)
        -[dotted]->
    endif

    :генерируем новые accessToken и refreshToken;
    :обновляем пользователю ID-device и FcmToken, которые
    пришли при авторизации;
    :авторизовываем пользователя;
    :добавляем к ответу salt и данные пользователя;

else (false)
    :кидается исключении с соответсвующей ошибкой;
endif
:отдаем ответ;
stop

left footer
<#f5f5f5,#172b3a>|= Project |= Version |= Creator |= Status|= Created_at |= Updated_at |
<#f5f5f5>|ArmaMotors| 1.0 | Rodomanov R. | dev | 14.01.2022 | 14.01.2022 |
endfooter
@enduml
